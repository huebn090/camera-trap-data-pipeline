#!/bin/bash -l
#PBS -l walltime=03:00:00,nodes=1:ppn=8:gpus=1
#PBS -j oe
#PBS -m abe
#PBS -M will5448@umn.edu
#PBS -q k40
#PBS -N eval
#PBS -o ${HOME}/job_ml_output.log
#PBS -e ${HOME}/job_ml_error.log

# Parameters
ID=test_run_GHmodel_MSIcode_originalImages
SITE=SER
SEASON=S7
ROOT=/home/packerc/shared/machine_learning/
CODE=${ROOT}code/deep_learning_for_camera_trap_images/phase2
LOG_DIR=${ROOT}data/models/${SITE}/species/phase2/
PREDICTIONS=${ROOT}data/predictions/species/${SITE}/${SEASON}/predictions_${ID}.txt
IMAGES_ROOT=/home/packerc/shared/albums/${SITE}/
DATA_INFO=${ROOT}data/info_files/${SITE}/${SEASON}_species.csv

# Log Parameters
echo "ID: $ID"
echo "SITE: $SITE"
echo "SEASON: $SEASON"
echo "ROOT: $ROOT"
echo "CODE: $CODE"
echo "LOG_DIR: $LOG_DIR"
echo "PREDICTIONS: $PREDICTIONS"
echo "IMAGES_ROOT: $IMAGES_ROOT"
echo "DATA_INFO: $DATA_INFO"

# Load Tensroflow
module load tensorflow/1.4_gpu

# Execute code
cd $CODE

python2 eval.py --log_dir $LOG_DIR \
--save_predictions $PREDICTIONS \
--architecture resnet \
--depth 152 \
--data_info $DATA_INFO \
--path_prefix $IMAGES_ROOT
